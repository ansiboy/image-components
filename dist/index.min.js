/*!
 * 
 *  maishu-image-components v1.5.0
 * 
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("maishu-ui-toolkit"),require("maishu-toolkit"),require("react-dom"),require("maishu-chitu")):"function"==typeof define&&define.amd?define(["react","maishu-ui-toolkit","maishu-toolkit","react-dom","maishu-chitu"],t):"object"==typeof exports?exports["image-components"]=t(require("react"),require("maishu-ui-toolkit"),require("maishu-toolkit"),require("react-dom"),require("maishu-chitu")):e["image-components"]=t(e.react,e["maishu-ui-toolkit"],e["maishu-toolkit"],e["react-dom"],e["maishu-chitu"])}(window,(function(e,t,n,i,a){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=17)}([function(e,t,n){"use strict";var i,a=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},r=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),o=[];function s(e){for(var t=-1,n=0;n<o.length;n++)if(o[n].identifier===e){t=n;break}return t}function l(e,t){for(var n={},i=[],a=0;a<e.length;a++){var r=e[a],l=t.base?r[0]+t.base:r[0],u=n[l]||0,c="".concat(l," ").concat(u);n[l]=u+1;var d=s(c),m={css:r[1],media:r[2],sourceMap:r[3]};-1!==d?(o[d].references++,o[d].updater(m)):o.push({identifier:c,updater:f(m,t),references:1}),i.push(c)}return i}function u(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var a=n.nc;a&&(i.nonce=a)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var o=r(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var c,d=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function m(e,t,n,i){var a=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=d(t,a);else{var r=document.createTextNode(a),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(r,o[t]):e.appendChild(r)}}function p(e,t,n){var i=n.css,a=n.media,r=n.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var h=null,g=0;function f(e,t){var n,i,a;if(t.singleton){var r=g++;n=h||(h=u(t)),i=m.bind(null,n,r,!1),a=m.bind(null,n,r,!0)}else n=u(t),i=p.bind(null,n,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=a());var n=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<n.length;i++){var a=s(n[i]);o[a].references--}for(var r=l(e,t),u=0;u<n.length;u++){var c=s(n[u]);0===o[c].references&&(o[c].updater(),o.splice(c,1))}n=r}}}},function(e,t,n){"use strict";function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw r}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}e.exports=function(e){var t=i(e,4),n=t[1],a=t[3];if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),s="/*# ".concat(o," */"),l=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[n].concat(l).concat([s]).join("\n")}return[n].join("\n")}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,i){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(i)for(var r=0;r<this.length;r++){var o=this[r][0];null!=o&&(a[o]=!0)}for(var s=0;s<e.length;s++){var l=[].concat(e[s]);i&&a[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setLanguage=t.getStrings=void 0;let i={chinese:{selectImage:"选择图片",selectMax:"最多可选",cancel:"取消",confirm:"确定",deleteImageConfirm:"确定删除该图片吗？",imageUpload:"图片上传",noImageText:"暂无图片",dataLoading:"数据正在加载中...",dataEmpty:"暂无所要展示的数据"},english:{selectImage:"Select Image",selectMax:"Select Max",cancel:"Cancel",confirm:"Confirm",deleteImageConfirm:"Are you sure delete the image?",imageUpload:"Image Upload",noImageText:"NO IMAGE",dataLoading:"Data is loading...",dataEmpty:"Data is empty"}};t.getStrings=function(e){return e=e||r(),i[e]};let a="chinese";function r(){return a}t.setLanguage=function(e){a=e}},function(e,t){e.exports=n},function(e,t,n){"use strict";var i=n(1),a=n.n(i),r=n(2),o=n.n(r)()(a.a);o.push([e.i,".image-thumber {\n  position: relative;\n}\n.image-thumber .item {\n  border: solid 1px #ccc;\n  height: calc(100% - 2px);\n}\n.image-thumber .item .bottom {\n  display: block;\n  overflow: hidden;\n  white-space: nowrap;\n  -webkit-text-overflow: ellipsis;\n  -ms-text-overflow: ellipsis;\n  -o-text-overflow: ellipsis;\n  text-overflow: ellipsis;\n  position: absolute;\n  bottom: 0;\n  padding: 4px 8px 0px 8px;\n  font-size: 12px;\n  text-align: center;\n  background-color: rgba(0, 0, 0, 0.55);\n  color: white;\n  width: calc(100% - 2px);\n  height: 24px;\n}\n.image-thumber .item .bottom button {\n  color: white;\n}\n.image-thumber .item .top {\n  position: absolute;\n  height: 18px;\n  margin-top: -18px;\n  padding-top: 18px;\n  color: white;\n  font-size: 12px;\n  font-weight: bold;\n  text-align: right;\n  width: calc(100% - 2px);\n}\n.image-thumber .item.selected {\n  border-color: blue;\n}\n.image-thumber .item.selected .triangle {\n  position: relative;\n  top: 19px;\n  left: calc(100% - 19px);\n  width: 20px;\n  height: 20px;\n  margin-top: -40px;\n  background: transparent;\n  border-top: 20px solid transparent;\n  border-bottom: 20px solid blue;\n  border-left: 20px solid transparent;\n  border-right: 20px solid transparent;\n  transform: rotate(45deg);\n}\n.image-thumber .item.selected:hover .remove {\n  display: none;\n}\n.image-thumber .item .remove {\n  display: none;\n}\n.image-thumber .item:hover .remove {\n  position: relative;\n  left: calc(100% - 20px);\n  top: 20px;\n  width: 20px;\n  height: 20px;\n  border-radius: 10px;\n  margin-top: -20px;\n  display: block;\n  background-color: rgba(0, 0, 0, 0.55);\n}\n.image-thumber .item:hover .remove i {\n  color: white;\n}\n.image-thumber .item .disabled {\n  position: absolute;\n  width: calc(100% - 2px);\n  height: calc(100% - 2px);\n  background-color: gray;\n  top: 0px;\n  opacity: 0.3;\n}\n","",{version:3,sources:["webpack://./content/image-thumber.less"],names:[],mappings:"AAAA;EACE,kBAAkB;AACpB;AACA;EACE,sBAAsB;EACtB,wBAAwB;AAC1B;AACA;EACE,cAAc;EACd,gBAAgB;EAChB,mBAAmB;EACnB,+BAA+B;EAC/B,2BAA2B;EAC3B,0BAA0B;EAC1B,uBAAuB;EACvB,kBAAkB;EAClB,SAAS;EACT,wBAAwB;EACxB,eAAe;EACf,kBAAkB;EAClB,qCAAqC;EACrC,YAAY;EACZ,uBAAuB;EACvB,YAAY;AACd;AACA;EACE,YAAY;AACd;AACA;EACE,kBAAkB;EAClB,YAAY;EACZ,iBAAiB;EACjB,iBAAiB;EACjB,YAAY;EACZ,eAAe;EACf,iBAAiB;EACjB,iBAAiB;EACjB,uBAAuB;AACzB;AACA;EACE,kBAAkB;AACpB;AACA;EACE,kBAAkB;EAClB,SAAS;EACT,uBAAuB;EACvB,WAAW;EACX,YAAY;EACZ,iBAAiB;EACjB,uBAAuB;EACvB,kCAAkC;EAClC,8BAA8B;EAC9B,mCAAmC;EACnC,oCAAoC;EACpC,wBAAwB;AAC1B;AACA;EACE,aAAa;AACf;AACA;EACE,aAAa;AACf;AACA;EACE,kBAAkB;EAClB,uBAAuB;EACvB,SAAS;EACT,WAAW;EACX,YAAY;EACZ,mBAAmB;EACnB,iBAAiB;EACjB,cAAc;EACd,qCAAqC;AACvC;AACA;EACE,YAAY;AACd;AACA;EACE,kBAAkB;EAClB,uBAAuB;EACvB,wBAAwB;EACxB,sBAAsB;EACtB,QAAQ;EACR,YAAY;AACd",sourcesContent:[".image-thumber {\n  position: relative;\n}\n.image-thumber .item {\n  border: solid 1px #ccc;\n  height: calc(100% - 2px);\n}\n.image-thumber .item .bottom {\n  display: block;\n  overflow: hidden;\n  white-space: nowrap;\n  -webkit-text-overflow: ellipsis;\n  -ms-text-overflow: ellipsis;\n  -o-text-overflow: ellipsis;\n  text-overflow: ellipsis;\n  position: absolute;\n  bottom: 0;\n  padding: 4px 8px 0px 8px;\n  font-size: 12px;\n  text-align: center;\n  background-color: rgba(0, 0, 0, 0.55);\n  color: white;\n  width: calc(100% - 2px);\n  height: 24px;\n}\n.image-thumber .item .bottom button {\n  color: white;\n}\n.image-thumber .item .top {\n  position: absolute;\n  height: 18px;\n  margin-top: -18px;\n  padding-top: 18px;\n  color: white;\n  font-size: 12px;\n  font-weight: bold;\n  text-align: right;\n  width: calc(100% - 2px);\n}\n.image-thumber .item.selected {\n  border-color: blue;\n}\n.image-thumber .item.selected .triangle {\n  position: relative;\n  top: 19px;\n  left: calc(100% - 19px);\n  width: 20px;\n  height: 20px;\n  margin-top: -40px;\n  background: transparent;\n  border-top: 20px solid transparent;\n  border-bottom: 20px solid blue;\n  border-left: 20px solid transparent;\n  border-right: 20px solid transparent;\n  transform: rotate(45deg);\n}\n.image-thumber .item.selected:hover .remove {\n  display: none;\n}\n.image-thumber .item .remove {\n  display: none;\n}\n.image-thumber .item:hover .remove {\n  position: relative;\n  left: calc(100% - 20px);\n  top: 20px;\n  width: 20px;\n  height: 20px;\n  border-radius: 10px;\n  margin-top: -20px;\n  display: block;\n  background-color: rgba(0, 0, 0, 0.55);\n}\n.image-thumber .item:hover .remove i {\n  color: white;\n}\n.image-thumber .item .disabled {\n  position: absolute;\n  width: calc(100% - 2px);\n  height: calc(100% - 2px);\n  background-color: gray;\n  top: 0px;\n  opacity: 0.3;\n}\n"],sourceRoot:""}]),t.a=o},function(e,t,n){"use strict";var i=n(1),a=n.n(i),r=n(2),o=n.n(r)()(a.a);o.push([e.i,'.image-upload .item {\n  border: 1px solid #cccccc;\n  text-align: center;\n  height: 120px;\n  width: 120px;\n}\n.image-upload input[type="file"] {\n  opacity: 0;\n  position: relative;\n  height: 120px;\n  width: 120px;\n  top: -100px;\n}\n.image-upload i {\n  margin-top: 20px;\n}\n',"",{version:3,sources:["webpack://./content/image-upload.less"],names:[],mappings:"AAAA;EACE,yBAAyB;EACzB,kBAAkB;EAClB,aAAa;EACb,YAAY;AACd;AACA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,YAAY;EACZ,WAAW;AACb;AACA;EACE,gBAAgB;AAClB",sourcesContent:['.image-upload .item {\n  border: 1px solid #cccccc;\n  text-align: center;\n  height: 120px;\n  width: 120px;\n}\n.image-upload input[type="file"] {\n  opacity: 0;\n  position: relative;\n  height: 120px;\n  width: 120px;\n  top: -100px;\n}\n.image-upload i {\n  margin-top: 20px;\n}\n'],sourceRoot:""}]),t.a=o},function(e,t,n){"use strict";var i=n(1),a=n.n(i),r=n(2),o=n.n(r)()(a.a);o.push([e.i,".image-manager {\n  z-index: 800;\n}\n.image-manager .modal-body .col-xs-2 {\n  margin-top: 6px;\n  margin-bottom: 6px;\n}\n.image-manager .modal-footer .pagination {\n  margin: 0;\n}\n.image-manager .modal-header h4 {\n  margin: 0;\n}\n.image-manager .image-thumber {\n  margin: 10px;\n  float: left;\n  position: relative;\n}\n.image-manager .image-upload {\n  margin: 10px;\n  float: left;\n}\n","",{version:3,sources:["webpack://./content/image-manager.less"],names:[],mappings:"AAAA;EACE,YAAY;AACd;AACA;EACE,eAAe;EACf,kBAAkB;AACpB;AACA;EACE,SAAS;AACX;AACA;EACE,SAAS;AACX;AACA;EACE,YAAY;EACZ,WAAW;EACX,kBAAkB;AACpB;AACA;EACE,YAAY;EACZ,WAAW;AACb",sourcesContent:[".image-manager {\n  z-index: 800;\n}\n.image-manager .modal-body .col-xs-2 {\n  margin-top: 6px;\n  margin-bottom: 6px;\n}\n.image-manager .modal-footer .pagination {\n  margin: 0;\n}\n.image-manager .modal-header h4 {\n  margin: 0;\n}\n.image-manager .image-thumber {\n  margin: 10px;\n  float: left;\n  position: relative;\n}\n.image-manager .image-upload {\n  margin: 10px;\n  float: left;\n}\n"],sourceRoot:""}]),t.a=o},function(e,t,n){"use strict";var i=n(1),a=n.n(i),r=n(2),o=n.n(r)()(a.a);o.push([e.i,".data-source-dialog .modal-footer .pagination {\n  float: left;\n  margin: 0;\n}\n.data-source-dialog .modal-body {\n  min-height: 300px;\n}\n.data-source-dialog .empty {\n  text-align: center;\n  padding: 120px;\n  width: 100%;\n}\n","",{version:3,sources:["webpack://./content/data-source-dialog.less"],names:[],mappings:"AAAA;EACE,WAAW;EACX,SAAS;AACX;AACA;EACE,iBAAiB;AACnB;AACA;EACE,kBAAkB;EAClB,cAAc;EACd,WAAW;AACb",sourcesContent:[".data-source-dialog .modal-footer .pagination {\n  float: left;\n  margin: 0;\n}\n.data-source-dialog .modal-body {\n  min-height: 300px;\n}\n.data-source-dialog .empty {\n  text-align: center;\n  padding: 120px;\n  width: 100%;\n}\n"],sourceRoot:""}]),t.a=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3),a=n(4);n(18);let r=n(5).getStrings();class o extends i.Component{constructor(e){super(e),this.state={selectedText:""}}setDeleteButton(e,t){e&&a.buttonOnClick(e,e=>(e.stopPropagation(),e.cancelBubble=!0,this.props.remove?this.props.remove(t):Promise.resolve()),{confirm:r.deleteImageConfirm})}render(){let{imagePath:e,className:t,onClick:n,selectedText:a,text:r,title:o,disabled:s}=this.props;return t=t||"",r=r||"",i.createElement("div",{className:"image-thumber "+t,title:o,"data-url":e,onClick:e=>{s||this.props.onClick&&this.props.onClick(this,e)}},i.createElement("div",{className:"item text-center  "+(a?"selected":"")},i.createElement("div",{className:"triangle"}),i.createElement("div",{className:"top"},a),this.props.remove?i.createElement("div",{className:"remove"},i.createElement("i",{className:"fa fa-remove",ref:t=>this.setDeleteButton(t,e)})):null,i.createElement("img",{className:"img-responsive",src:e}),r?i.createElement("div",{className:"bottom"},r):null,s?i.createElement("div",{className:"disabled"}):null,this.props.children))}}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3),a=n(4);n(19);const r=n(5),o=n(13);let s=r.getStrings();class l extends i.Component{constructor(e){super(e),this.state={imageSource:e.imageSource}}updloadImage(e){let{width:t,height:n}=this.props;a.imageFileToBase64(e).then(e=>{this.props.saveImage(e),this.setState({imageSource:e.base64})})}setFileInput(e){e&&!e.onchange&&(this.file=e,e.onchange=()=>{null!=e.files&&e.files.length>0&&this.updloadImage(e.files[0])})}componentDidMount(){}setSizes(){let e=this.itemElement.offsetWidth;e<10&&setTimeout(()=>{this.setSizes()},100);let t=e,n=0;this.itemElement.style.height=t+"px",t>80&&(n=(t-80)/2,this.itemElement.style.paddingTop=n+"px"),this.file.style.marginTop=`-${t-n}px`,this.file.style.width=e+"px",this.file.style.height=t+"px"}render(){let{title:e,className:t}=this.props,{imageSource:n}=this.state||{};return e=e||s.imageUpload,t=t||"",null==n||null==this.props.displayImage?i.createElement("div",{className:"image-upload "+t,style:this.props.style},i.createElement("div",{className:"item",ref:e=>this.itemElement=e||this.itemElement},i.createElement(i.Fragment,null,i.createElement("i",{className:"fa fa-plus fa-4x"}),i.createElement("div",null,e)),i.createElement("input",{type:"file",style:{},ref:e=>this.setFileInput(e)}))):this.props.displayImage.fixed?i.createElement("div",{className:"image-upload "+t,style:this.props.style},i.createElement("div",{className:"item",ref:e=>this.itemElement=e||this.itemElement},i.createElement("img",{src:n,style:{width:"100%",height:"100%"}}))):i.createElement("div",{ref:e=>{if(!e)return;let t=document.createElement("img");t.src=n,t.onload=t=>{var n;let i=t.target.width,a=t.target.height,r=null===(n=this.props.displayImage)||void 0===n?void 0:n.maxWidth;if(r){a=r*(a/i),i=r}e.style.backgroundImage=`url(${t.target.src})`,e.style.backgroundSize=`${i}px ${a}px`,e.style.backgroundRepeat="no-repeat";let o=e.querySelector('[type="file"]');o.style.width=i+"px",o.style.height=a+"px"},o.render(i.createElement(i.Fragment,null,i.createElement("input",{type:"file",style:{opacity:0},ref:e=>this.setFileInput(e)})),e)}})}}t.default=l},function(e,t){e.exports=i},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageService=t.errors=void 0;const a=n(22),r=n(6),o=n(4);let s=n(5).getStrings();t.errors={serviceUrlCanntNull:e=>new Error(`Service '${e}' base url can not null.`),unexpectedNullResult:()=>new Error("Null result is unexpected."),unexpectedNullValue:e=>new Error(`variable ${e} is unexpected null value.`),argumentNull:e=>new Error(`Arugment ${e} cannt null or empty.`),fieldNull:(e,t)=>new Error(`${t} ${e} cannt be null or empty`),instanceMessangerStart:()=>new Error("Instance messanger is start."),notSupportedInNode:()=>new Error("Not implement in node environment.")};class l extends a.Service{constructor(){super(e=>l.errorHandle(e))}url(e){return r.pathConcat(l.serviceHost,e)}imageSource(e,t,n){if(!e)return t=null==t?200:t,n=null==n?200:n,e=this.generateImageBase64(t,n,s.noImageText);if(e.startsWith("data:image"))return e;if(null!=e&&(e.startsWith("http://")||e.startsWith("https://")))return e;if(null!=e&&e.indexOf("/")>=0){let i=r.pathConcat(l.serviceHost,e),a="";return null!=t&&(a=a+"&width="+t),null!=n&&(a=a+"&height="+n),a.length>0&&(a=a.substr(1),i=i+"?"+a),i}let i=this.url("image");return i=`${i}?id=${e}`,null!=t&&(i=i+"&width="+t),null!=n&&(i=i+"&height="+n),i}generateImageBase64(e,n,i,a){if(null==document)throw t.errors.notSupportedInNode();var r=document.createElement("canvas");r.width=e,r.height=n;var o=r.getContext("2d");if(null==o)throw new Error("ccreate canvas context fail.");return("string"==typeof i?u.text(i,a):i)(o,e,n),r.toDataURL()}getImageSize(e){if(!e)throw t.errors.argumentNull("imageBase64");return new Promise((t,n)=>{var i=new Image;i.onload=function(){t({width:i.width,height:i.height})},i.src=e})}resize(e,n,a){return i(this,void 0,void 0,(function*(){if(!e)throw t.errors.argumentNull("imageBase64");if(!n)throw t.errors.argumentNull("width");if(!a)throw t.errors.argumentNull("height");var i=document.createElement("canvas"),r=i.getContext("2d");return i.width=n,i.height=a,yield new Promise((t,n)=>{var a=new Image;a.src=e,a.onload=function(){if(null==r)throw"get canvas context fail";r.drawImage(a,0,0,i.width,i.height),t(i.toDataURL())}})}))}list(e){return i(this,void 0,void 0,(function*(){let t=this.url("list");return yield this.postByJson(t,e)}))}upload(e){return i(this,void 0,void 0,(function*(){if(!e)throw t.errors.argumentNull("imageBase64");let n=this.url("upload"),i=yield this.getImageSize(e);if(i.width>800){let t=i.height/i.width*800;e=yield this.resize(e,800,t)}else if(i.height>800){let t=i.width/i.height*800;e=yield this.resize(e,t,800)}return this.postByJson(n,{image:e})}))}remove(e){return i(this,void 0,void 0,(function*(){if(!e)throw t.errors.argumentNull("id");let n=this.url("remove");return this.postByJson(n,{id:e})}))}}t.ImageService=l,l.errorHandle=e=>{o.alert({title:"错误",message:e.message})};let u={text:(e,t)=>(n,i,a)=>{let r=Math.floor(i/e.length*.6);t=t||{},n.fillStyle=t.bgColor||"whitesmoke",n.fillRect(0,0,i,a),n.font=`Bold ${t.fontSize}px Arial`,n.textAlign="left",n.fillStyle=t.textColor||"#999";let o=r*e.length,s=Math.floor(.5*(i-o));Math.floor(.3*(a-(t.fontSize||r)));n.fillText(e,s,Math.floor(.6*a))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataSourcePagingBar=t.PagingBar=t.PagerPosition=void 0;const i=n(24);!function(e){e[e.Bottom=0]="Bottom",e[e.Top=1]="Top",e[e.TopAndBottom=2]="TopAndBottom"}(t.PagerPosition||(t.PagerPosition={}));class a{init(e){this._pageIndex=0;var t=this;t.totalRowCount=1e6,e&&(e.selected.add(e=>{this._selectArguments=e.selectArguments,t.pageSize=e.selectArguments.maximumRows||0;var n=e.selectResult.totalRowCount;null!=n&&n>=0&&(t.totalRowCount=n);var i=this._selectArguments.startRowIndex;(null==i||i<=0)&&(i=0),t.pageIndex=Math.floor(i/t.pageSize),t.render()}),e.deleted.add((function(){t.totalRowCount=t.totalRowCount-1,t.render()})),e.inserted.add((function(){t.totalRowCount=t.totalRowCount+1,t.render()})))}get selectArguments(){return console.assert(null!=this._selectArguments),this._selectArguments}get pageCount(){return Math.ceil(this.totalRowCount/this.pageSize)}get pageSize(){return this._pageSize}set pageSize(e){this._pageSize=e}get pageIndex(){return this._pageIndex}set pageIndex(e){this._pageIndex=e}get totalRowCount(){return this._totalRowCount}set totalRowCount(e){this._totalRowCount=e}render(){throw i.errors.notImplemented("The table-row render method is not implemented.")}}t.PagingBar=a;class r extends a{constructor(e){if(!e.dataSource)throw i.errors.argumentNull("dataSource");if(!e.element)throw i.errors.argumentNull("element");let t=Object.assign(r.defaultPagerSettings,e.pagerSettings||{});super(),this.dataSource=e.dataSource,this.pagerSettings=t,this.element=e.element,this.numberButtons=new Array,this.createButton=this.createPagingButton,this.createLabel=this.createTotalLabel;let n=t.buttonContainerWraper?document.createElement(t.buttonContainerWraper):document.createElement("div");n.className=t.buttonContainerClassName||"buttons",this.element.appendChild(n),this.createPreviousButtons(n),this.createNumberButtons(n),this.createNextButtons(n),this.pagerSettings.showTotal&&(this.totalElement=this.createLabel(),this.totalElement.visible=!1),this.init(e.dataSource)}createPagingButton(e){var t=this.pagerSettings;let n=document.createElement("a");if(n.href="javascript:",this.pagerSettings.buttonWrapper){let t=document.createElement(this.pagerSettings.buttonWrapper);t.appendChild(n),e.appendChild(t)}else e.appendChild(n);let i={_button:n,get visible(){return"none"!=this._button.style.display},set visible(e){let n=this._button,i=t.buttonWrapper?n.parentElement:n;null!=i&&(e?i.style.removeProperty("display"):i.style.display="none")},get pageIndex(){let e=this._button;return new Number(e.getAttribute("pageIndex")).valueOf()},set pageIndex(e){this._button.setAttribute("pageIndex",e)},get text(){return this._button.innerHTML},set text(e){this._button.innerHTML=e},get active(){return null!=this._button.href},set active(e){let n=this._button;if(1==e)return n.removeAttribute("href"),void(t.activeButtonClassName&&this.setClassName(t.activeButtonClassName));n.href="javascript:",t.buttonClassName?this.setClassName(t.buttonClassName):this.setClassName(null)},setClassName(e){let n=this._button,i=t.buttonWrapper?n.parentElement:n;null!=i&&(e?i.className=e:i.removeAttribute("class"))},onclick:null};return n.onclick=()=>{i.onclick&&i.onclick(i,this)},i}createTotalLabel(){let e=document.createElement("div");e.className="total";let t=document.createElement("span");t.className="text",t.innerHTML="总记录：",e.appendChild(t);let n=document.createElement("span");return n.className="number",e.appendChild(n),this.element.appendChild(e),{get text(){return n.innerHTML},set text(e){n.innerHTML=e},get visible(){return"none"!=e.style.display},set visible(t){e.style.display=1==t?"block":"node"}}}createPreviousButtons(e){this.firstPageButton=this.createButton(e),this.firstPageButton.onclick=r.on_buttonClick,this.firstPageButton.text=this.pagerSettings.firstPageText,this.firstPageButton.visible=!1,this.previousPageButton=this.createButton(e),this.previousPageButton.onclick=r.on_buttonClick,this.previousPageButton.text=this.pagerSettings.previousPageText,this.previousPageButton.visible=!1}createNextButtons(e){this.nextPageButton=this.createButton(e),this.nextPageButton.onclick=r.on_buttonClick,this.nextPageButton.text=this.pagerSettings.nextPageText,this.nextPageButton.visible=!1,this.lastPageButton=this.createButton(e),this.lastPageButton.onclick=r.on_buttonClick,this.lastPageButton.text=this.pagerSettings.lastPageText,this.lastPageButton.visible=!1}createNumberButtons(e){let t=this,n=this.pagerSettings.pageButtonCount;for(let t=0;t<n;t++){let n=this.createButton(e);n.onclick=r.on_buttonClick,this.numberButtons[t]=n}this.numberButtons.forEach(e=>{e.onclick=()=>r.on_buttonClick(e,t)})}static on_buttonClick(e,t){let n=e.pageIndex;if(null==!n)return;let i=t.selectArguments;i.maximumRows=t.pageSize,i.startRowIndex=n*t.pageSize,t.pageIndex=n,t.dataSource.select(t.selectArguments)}render(){var e=this.pagerSettings.pageButtonCount;let t=Math.floor(this.pageIndex/e),n=Math.ceil(this.pageCount/e);this.previousPageButton.pageIndex=(t-1)*e,this.nextPageButton.pageIndex=(t+1)*e,this.firstPageButton.pageIndex=0,this.lastPageButton.pageIndex=this.pageCount-1;for(let n=0;n<this.numberButtons.length;n++){let i=t*e+n;i<this.pageCount?(this.numberButtons[n].pageIndex=i,this.numberButtons[n].text=(t*e+n+1).toString(),this.numberButtons[n].visible=!0,this.numberButtons[n].active=i==this.pageIndex):this.numberButtons[n].visible=!1}this.totalElement&&(this.totalElement.text=this.totalRowCount,this.totalElement.visible=!0),this.firstPageButton.visible=!1,this.previousPageButton.visible=!1,this.lastPageButton.visible=!1,this.nextPageButton.visible=!1,t>0&&(this.firstPageButton.visible=!0,this.previousPageButton.visible=!0),t<n-1&&(this.lastPageButton.visible=!0,this.nextPageButton.visible=!0)}}t.DataSourcePagingBar=r,r.defaultPagerSettings={pageButtonCount:10,firstPageText:"<<",lastPageText:">>",nextPageText:"...",previousPageText:"...",showTotal:!0}},function(e,t,n){"use strict";var i,a=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},r=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ModalDialog=void 0;const o=n(4),s=n(3);class l extends s.Component{constructor(){super(...arguments),i.set(this,void 0)}show(){o.showDialog(a(this,i))}hide(){o.hideDialog(a(this,i))}render(){return s.createElement("div",{className:"modal fade "+(this.props.className||""),ref:e=>r(this,i,e||a(this,i))},s.createElement("div",{className:"modal-dialog "+(this.props.isLarge?"modal-lg":"")},s.createElement("div",{className:"modal-content"},this.header(),this.body(),this.footer())))}findChild(e){return this.findChildren(e)[0]}findChildren(e){if(null==this.props.children)return[];return(Array.isArray(this.props.children)?this.props.children:[this.props.children]).filter(e)}footer(){let e=this.findChild(e=>{var t;return"modal-footer"==(null===(t=e.props)||void 0===t?void 0:t.className)});return null==e&&(e=s.createElement("div",{className:"modal-footer",style:{marginTop:0}},s.createElement("button",{type:"button",className:"btn btn-default","data-dismiss":"modal"},this.props.cancelButtonText||"取消"),s.createElement("button",{type:"button",className:"btn btn-primary",onClick:()=>this.props.onConfirm?this.props.onConfirm():null},this.props.confirmButtonText||"确定"))),e}header(){let e=this.findChild(e=>{var t;return"modal-header"==(null===(t=e.props)||void 0===t?void 0:t.className)});return null==e&&(e=s.createElement("div",{className:"modal-header"},s.createElement("button",{type:"button",className:"btn close","data-dismiss":"modal"},s.createElement("span",{"aria-hidden":"true"},"×"),s.createElement("span",{className:"sr-only"},"Close")),s.createElement("h4",{className:"modal-title"},this.props.title||""))),e}body(){let e=this.findChild(e=>{var t;return"div"==e.type&&"modal-body"==(null===(t=e.props)||void 0===t?void 0:t.className)});if(null==e){let t=["modal-header","modal-body","modal-footer"],n=this.findChildren(e=>{var n;return t.indexOf(null===(n=e.props)||void 0===n?void 0:n.className)<0});e=s.createElement("div",{className:"modal-body"},n)}return e}}t.ModalDialog=l,i=new WeakMap},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataSourceDialogContext=t.DataSourceDialog=t.ModalDialog=t.ImageService=t.showImageDialog=t.ImageUpload=t.ImageThumber=void 0;var i=n(11);Object.defineProperty(t,"ImageThumber",{enumerable:!0,get:function(){return i.default}});var a=n(12);Object.defineProperty(t,"ImageUpload",{enumerable:!0,get:function(){return a.default}});var r=n(20);Object.defineProperty(t,"showImageDialog",{enumerable:!0,get:function(){return r.showImageDialog}});var o=n(14);Object.defineProperty(t,"ImageService",{enumerable:!0,get:function(){return o.ImageService}});var s=n(16);Object.defineProperty(t,"ModalDialog",{enumerable:!0,get:function(){return s.ModalDialog}});var l=n(25);Object.defineProperty(t,"DataSourceDialog",{enumerable:!0,get:function(){return l.DataSourceDialog}}),Object.defineProperty(t,"DataSourceDialogContext",{enumerable:!0,get:function(){return l.DataSourceDialogContext}})},function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),r=n(7),o={insert:"head",singleton:!1};a()(r.a,o);t.default=r.a.locals||{}},function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),r=n(8),o={insert:"head",singleton:!1};a()(r.a,o);t.default=r.a.locals||{}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.showImageDialog=void 0;const a=n(12),r=n(11),o=n(3),s=n(13),l=n(21),u=n(4),c=n(14),d=n(5),m=n(6);n(23);const p=n(15);let h=d.getStrings();class g extends o.Component{constructor(e){super(e),this.state={images:[],selectedItems:[]},this.selectArguments={maximumRows:17},this.dataSource=function(){let e=new c.ImageService;return new m.DataSource({primaryKeys:["id"],select(t){return i(this,void 0,void 0,(function*(){return yield e.list(t)}))},delete(t){return i(this,void 0,void 0,(function*(){return yield e.remove(t.id)}))},insert(t){return i(this,void 0,void 0,(function*(){console.assert(null!=t.data);let n=yield e.upload(t.data);return Object.assign(t,n),n}))}})}(),this.dataSource.selected.add(e=>{this.setState({images:e.selectResult.dataItems})}),this.dataSource.inserted.add(e=>{this.state.images.push(e.dataItem),this.setState({images:this.state.images})}),this.imageService=new c.ImageService}componentDidMount(){return i(this,void 0,void 0,(function*(){new p.DataSourcePagingBar({dataSource:this.dataSource,element:this.pagingBarElement,pagerSettings:{activeButtonClassName:"active",buttonWrapper:"li",buttonContainerWraper:"ul",showTotal:!1}});let e=this.pagingBarElement.querySelector("ul");e&&(e.className="pagination")}))}show(e,t){this.showDialogCallback=t,this.selectArguments.startRowIndex=0,this.dataSource.select(this.selectArguments),this.setState({selectedItems:[],selectedMax:e}),u.showDialog(this.props.element)}saveImage(e){return i(this,void 0,void 0,(function*(){this.dataSource.insert({data:e})}))}removeImage(e){this.dataSource.delete(e);let t=this.state.images;t=t.filter(t=>t.id!=e.id),this.setState({images:t})}render(){let{images:e,selectedItems:t,selectedMax:n}=this.state,i=this.props.element;return o.createElement("div",{className:"modal-dialog modal-lg"},o.createElement("div",{className:"modal-content"},o.createElement("div",{className:"modal-header"},o.createElement("button",{type:"button",className:"btn close",onClick:()=>u.hideDialog(i)},o.createElement("span",{"aria-hidden":"true"},"×")),o.createElement("h4",{className:"modal-title"},h.selectImage)),o.createElement("div",{className:"modal-body"},e.map(e=>{let i=t.indexOf(e.id)>=0?""+(t.indexOf(e.id)+1):"",a=t.length==n;return o.createElement(r.default,{key:e.id,imagePath:this.imageService.imageSource(e.id,150,150),remove:()=>this.removeImage(e),selectedText:i,disabled:a&&!i,text:null!=e.width&&null!=e.height?`${e.width} X ${e.height}`:" ",onClick:()=>{let t=this.state.selectedItems;if(t.indexOf(e.id)>=0)t=t.filter(t=>t!=e.id);else{if(t.length==n)return;t.push(e.id)}this.setState({selectedItems:t})}})}),o.createElement(a.default,{saveImage:e=>this.saveImage(e.base64),width:400}),o.createElement("div",{className:"clearfix"})),o.createElement("div",{className:"modal-footer"},o.createElement("div",{className:"pull-left",ref:e=>this.pagingBarElement=e||this.pagingBarElement}),n?o.createElement("div",{className:"pull-left",style:{paddingTop:8,paddingLeft:10}},h.selectMax,o.createElement("b",{style:{padding:"0 2px 0 2px"}},n),"张"):null,o.createElement("button",{name:"cancel",type:"button",className:"btn btn-default",onClick:()=>u.hideDialog(i)},h.cancel),o.createElement("button",{name:"ok",type:"button",className:"btn btn-primary",disabled:0==t.length,onClick:()=>{if(this.showDialogCallback){let e=this.state.selectedItems.map(e=>e);this.showDialogCallback(e)}u.hideDialog(i)}},h.confirm))))}}let f=l.createDialogElement("image-manager"),A=s.render(o.createElement(g,{element:f}),f);t.default={show(e){A.show(void 0,e)}},t.showImageDialog=function(e,t){"function"==typeof e&&(t=e=null),A.show(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDialogElement=t.imageUrl=void 0,t.imageUrl=function(e,t,n){if(!e)return e;if(e.startsWith("data:image"))return e;if(e.indexOf(",")>0&&(e=e.split(",")[0]),e.startsWith("http://")){let t=(e=e.substr("http://".length)).indexOf("/");console.assert(t>0),e=e.substr(t)}else"/"==e[0]&&(e=e.substr(1));let i=new Array,a=(location.protocol,""+e);return t&&(i.push({name:"width",value:t.toString()}),n&&i.push({name:"height",value:n.toString()})),navigator.userAgent.indexOf("chrome")<0&&i.push({name:"type",value:"jpeg"}),i.length>0&&(a=a+"?"+i.map(e=>`${e.name}=${e.value}`).join("&")),a},t.createDialogElement=function(e){let t=document.createElement("div");return t.className="modal fade "+e,t.style.zIndex="1000",document.body.appendChild(t),t}},function(e,t){e.exports=a},function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),r=n(9),o={insert:"head",singleton:!1};a()(r.a,o);t.default=r.a.locals||{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errors=void 0;const i=n(6);class a extends i.Errors{serviceHostNotConfig(){return new Error("Service host is not config.")}notImplemented(e){return e=e||"Not implemented",new Error(e)}}t.errors=new a},function(e,t,n){"use strict";var i,a,r=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},o=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.DataSourceDialog=t.DataSourceDialogContext=void 0;const s=n(3),l=n(15),u=n(5),c=n(16);n(26);let d=u.getStrings();t.DataSourceDialogContext=s.createContext({dataItem:null});class m extends s.Component{constructor(e){super(e),i.set(this,void 0),a.set(this,void 0),this.state={},this.props.dataSource.selecting.add(e=>{this.setState({items:void 0})}),this.props.dataSource.selected.add(e=>{this.setState({items:e.selectResult.dataItems})}),this.props.dataSource.inserted.add(e=>{var t;null===(t=this.state.items)||void 0===t||t.push(e.dataItem),this.setState({items:this.state.items})})}show(){this.props.dataSource.select({maximumRows:this.props.pageItemsCount}),r(this,a).show()}confirm(){}pagingBarRef(e){if(!e||r(this,i))return;o(this,i,new l.DataSourcePagingBar({dataSource:this.props.dataSource,element:e,pagerSettings:{activeButtonClassName:"active",buttonWrapper:"li",buttonContainerWraper:"ul",showTotal:!1}}));let t=e.querySelector("ul");t&&(t.className="pagination")}renderBody(){let{items:e}=this.state;return void 0===e?s.createElement("div",{className:"empty"},d.dataLoading):null==e||0==e.length?s.createElement("div",{className:"empty"},d.dataEmpty):e.map((e,n)=>s.createElement(t.DataSourceDialogContext.Provider,{key:n,value:{dataItem:e}},this.props.children))}componentDidMount(){}render(){return s.createElement(c.ModalDialog,Object.assign({},this.props,{className:"data-source-dialog",ref:e=>o(this,a,e||r(this,a))}),s.createElement("div",{className:"modal-body"},this.renderBody()),s.createElement("div",{className:"modal-footer",style:{marginTop:0},ref:e=>this.pagingBarRef(e)},s.createElement("button",{type:"button",className:"btn btn-default","data-dismiss":"modal"},this.props.cancelButtonText||"取消"),s.createElement("button",{type:"button",className:"btn btn-primary",onClick:()=>this.confirm()},this.props.confirmButtonText||"确定")))}}t.DataSourceDialog=m,i=new WeakMap,a=new WeakMap},function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),r=n(10),o={insert:"head",singleton:!1};a()(r.a,o);t.default=r.a.locals||{}}])}));
//# sourceMappingURL=index.min.js.map