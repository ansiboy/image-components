/*!
 * 
 *  maishu-image-components v1.4.1
 * 
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("maishu-ui-toolkit"),require("react"),require("maishu-toolkit"),require("react-dom"),require("maishu-chitu")):"function"==typeof define&&define.amd?define(["maishu-ui-toolkit","react","maishu-toolkit","react-dom","maishu-chitu"],t):"object"==typeof exports?exports["image-components"]=t(require("maishu-ui-toolkit"),require("react"),require("maishu-toolkit"),require("react-dom"),require("maishu-chitu")):e["image-components"]=t(e["maishu-ui-toolkit"],e.react,e["maishu-toolkit"],e["react-dom"],e["maishu-chitu"])}(window,(function(e,t,n,i,r){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){"use strict";var i,r=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},a=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),o=[];function s(e){for(var t=-1,n=0;n<o.length;n++)if(o[n].identifier===e){t=n;break}return t}function l(e,t){for(var n={},i=[],r=0;r<e.length;r++){var a=e[r],l=t.base?a[0]+t.base:a[0],u=n[l]||0,c="".concat(l," ").concat(u);n[l]=u+1;var m=s(c),d={css:a[1],media:a[2],sourceMap:a[3]};-1!==m?(o[m].references++,o[m].updater(d)):o.push({identifier:c,updater:A(d,t),references:1}),i.push(c)}return i}function u(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var r=n.nc;r&&(i.nonce=r)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var o=a(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var c,m=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function d(e,t,n,i){var r=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=m(t,r);else{var a=document.createTextNode(r),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(a,o[t]):e.appendChild(a)}}function p(e,t,n){var i=n.css,r=n.media,a=n.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var h=null,g=0;function A(e,t){var n,i,r;if(t.singleton){var a=g++;n=h||(h=u(t)),i=d.bind(null,n,a,!1),r=d.bind(null,n,a,!0)}else n=u(t),i=p.bind(null,n,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=r());var n=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<n.length;i++){var r=s(n[i]);o[r].references--}for(var a=l(e,t),u=0;u<n.length;u++){var c=s(n[u]);0===o[c].references&&(o[c].updater(),o.splice(c,1))}n=a}}}},function(e,t,n){"use strict";function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}e.exports=function(e){var t=i(e,4),n=t[1],r=t[3];if("function"==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),s="/*# ".concat(o," */"),l=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(e," */")}));return[n].concat(l).concat([s]).join("\n")}return[n].join("\n")}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,i){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(i)for(var a=0;a<this.length;a++){var o=this[a][0];null!=o&&(r[o]=!0)}for(var s=0;s<e.length;s++){var l=[].concat(e[s]);i&&r[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setLanguage=t.getStrings=void 0;let i={chinese:{selectImage:"选择图片",selectMax:"最多可选",cancel:"取消",confirm:"确定",deleteImageConfirm:"确定删除该图片吗？",imageUpload:"图片上传",noImageText:"暂无图片"},english:{selectImage:"Select Image",selectMax:"Select Max",cancel:"Cancel",confirm:"Confirm",deleteImageConfirm:"Are you sure delete the image?",imageUpload:"Image Upload",noImageText:"NO IMAGE"}};t.getStrings=function(e){return e=e||a(),i[e]};let r="chinese";function a(){return r}t.setLanguage=function(e){r=e}},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){"use strict";var i=n(1),r=n.n(i),a=n(2),o=n.n(a)()(r.a);o.push([e.i,".image-thumber {\n  position: relative;\n}\n.image-thumber .item {\n  border: solid 1px #ccc;\n}\n.image-thumber .item .bottom {\n  display: block;\n  overflow: hidden;\n  white-space: nowrap;\n  -webkit-text-overflow: ellipsis;\n  -ms-text-overflow: ellipsis;\n  -o-text-overflow: ellipsis;\n  text-overflow: ellipsis;\n  position: absolute;\n  bottom: 0;\n  padding: 4px 8px 0px 8px;\n  font-size: 12px;\n  text-align: center;\n  background-color: rgba(0, 0, 0, 0.55);\n  color: white;\n  width: calc(100% - 2px);\n  height: 24px;\n}\n.image-thumber .item .bottom button {\n  color: white;\n}\n.image-thumber .item .top {\n  position: absolute;\n  height: 18px;\n  margin-top: -18px;\n  padding-top: 18px;\n  color: white;\n  font-size: 12px;\n  font-weight: bold;\n  text-align: right;\n  width: calc(100% - 2px);\n}\n.image-thumber .item.selected {\n  border-color: blue;\n}\n.image-thumber .item.selected .triangle {\n  position: relative;\n  top: 19px;\n  left: calc(100% - 19px);\n  width: 20px;\n  height: 20px;\n  margin-top: -40px;\n  background: transparent;\n  border-top: 20px solid transparent;\n  border-bottom: 20px solid blue;\n  border-left: 20px solid transparent;\n  border-right: 20px solid transparent;\n  transform: rotate(45deg);\n}\n.image-thumber .item.selected:hover .remove {\n  display: none;\n}\n.image-thumber .item .remove {\n  display: none;\n}\n.image-thumber .item:hover .remove {\n  position: relative;\n  left: calc(100% - 20px);\n  top: 20px;\n  width: 20px;\n  height: 20px;\n  border-radius: 10px;\n  margin-top: -20px;\n  display: block;\n  background-color: rgba(0, 0, 0, 0.55);\n}\n.image-thumber .item:hover .remove i {\n  color: white;\n}\n.image-thumber .item .disabled {\n  position: absolute;\n  width: calc(100% - 2px);\n  height: calc(100% - 2px);\n  background-color: gray;\n  top: 0px;\n  opacity: 0.3;\n}\n","",{version:3,sources:["webpack://./content/image-thumber.less"],names:[],mappings:"AAAA;EACE,kBAAkB;AACpB;AACA;EACE,sBAAsB;AACxB;AACA;EACE,cAAc;EACd,gBAAgB;EAChB,mBAAmB;EACnB,+BAA+B;EAC/B,2BAA2B;EAC3B,0BAA0B;EAC1B,uBAAuB;EACvB,kBAAkB;EAClB,SAAS;EACT,wBAAwB;EACxB,eAAe;EACf,kBAAkB;EAClB,qCAAqC;EACrC,YAAY;EACZ,uBAAuB;EACvB,YAAY;AACd;AACA;EACE,YAAY;AACd;AACA;EACE,kBAAkB;EAClB,YAAY;EACZ,iBAAiB;EACjB,iBAAiB;EACjB,YAAY;EACZ,eAAe;EACf,iBAAiB;EACjB,iBAAiB;EACjB,uBAAuB;AACzB;AACA;EACE,kBAAkB;AACpB;AACA;EACE,kBAAkB;EAClB,SAAS;EACT,uBAAuB;EACvB,WAAW;EACX,YAAY;EACZ,iBAAiB;EACjB,uBAAuB;EACvB,kCAAkC;EAClC,8BAA8B;EAC9B,mCAAmC;EACnC,oCAAoC;EACpC,wBAAwB;AAC1B;AACA;EACE,aAAa;AACf;AACA;EACE,aAAa;AACf;AACA;EACE,kBAAkB;EAClB,uBAAuB;EACvB,SAAS;EACT,WAAW;EACX,YAAY;EACZ,mBAAmB;EACnB,iBAAiB;EACjB,cAAc;EACd,qCAAqC;AACvC;AACA;EACE,YAAY;AACd;AACA;EACE,kBAAkB;EAClB,uBAAuB;EACvB,wBAAwB;EACxB,sBAAsB;EACtB,QAAQ;EACR,YAAY;AACd",sourcesContent:[".image-thumber {\n  position: relative;\n}\n.image-thumber .item {\n  border: solid 1px #ccc;\n}\n.image-thumber .item .bottom {\n  display: block;\n  overflow: hidden;\n  white-space: nowrap;\n  -webkit-text-overflow: ellipsis;\n  -ms-text-overflow: ellipsis;\n  -o-text-overflow: ellipsis;\n  text-overflow: ellipsis;\n  position: absolute;\n  bottom: 0;\n  padding: 4px 8px 0px 8px;\n  font-size: 12px;\n  text-align: center;\n  background-color: rgba(0, 0, 0, 0.55);\n  color: white;\n  width: calc(100% - 2px);\n  height: 24px;\n}\n.image-thumber .item .bottom button {\n  color: white;\n}\n.image-thumber .item .top {\n  position: absolute;\n  height: 18px;\n  margin-top: -18px;\n  padding-top: 18px;\n  color: white;\n  font-size: 12px;\n  font-weight: bold;\n  text-align: right;\n  width: calc(100% - 2px);\n}\n.image-thumber .item.selected {\n  border-color: blue;\n}\n.image-thumber .item.selected .triangle {\n  position: relative;\n  top: 19px;\n  left: calc(100% - 19px);\n  width: 20px;\n  height: 20px;\n  margin-top: -40px;\n  background: transparent;\n  border-top: 20px solid transparent;\n  border-bottom: 20px solid blue;\n  border-left: 20px solid transparent;\n  border-right: 20px solid transparent;\n  transform: rotate(45deg);\n}\n.image-thumber .item.selected:hover .remove {\n  display: none;\n}\n.image-thumber .item .remove {\n  display: none;\n}\n.image-thumber .item:hover .remove {\n  position: relative;\n  left: calc(100% - 20px);\n  top: 20px;\n  width: 20px;\n  height: 20px;\n  border-radius: 10px;\n  margin-top: -20px;\n  display: block;\n  background-color: rgba(0, 0, 0, 0.55);\n}\n.image-thumber .item:hover .remove i {\n  color: white;\n}\n.image-thumber .item .disabled {\n  position: absolute;\n  width: calc(100% - 2px);\n  height: calc(100% - 2px);\n  background-color: gray;\n  top: 0px;\n  opacity: 0.3;\n}\n"],sourceRoot:""}]),t.a=o},function(e,t,n){"use strict";var i=n(1),r=n.n(i),a=n(2),o=n.n(a)()(r.a);o.push([e.i,'.image-upload .item {\n  border: 1px solid #cccccc;\n  text-align: center;\n  height: 120px;\n  width: 120px;\n}\n.image-upload input[type="file"] {\n  opacity: 0;\n  position: relative;\n  height: 120px;\n  width: 120px;\n  top: -100px;\n}\n.image-upload i {\n  margin-top: 20px;\n}\n',"",{version:3,sources:["webpack://./content/image-upload.less"],names:[],mappings:"AAAA;EACE,yBAAyB;EACzB,kBAAkB;EAClB,aAAa;EACb,YAAY;AACd;AACA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,YAAY;EACZ,WAAW;AACb;AACA;EACE,gBAAgB;AAClB",sourcesContent:['.image-upload .item {\n  border: 1px solid #cccccc;\n  text-align: center;\n  height: 120px;\n  width: 120px;\n}\n.image-upload input[type="file"] {\n  opacity: 0;\n  position: relative;\n  height: 120px;\n  width: 120px;\n  top: -100px;\n}\n.image-upload i {\n  margin-top: 20px;\n}\n'],sourceRoot:""}]),t.a=o},function(e,t,n){"use strict";var i=n(1),r=n.n(i),a=n(2),o=n.n(a)()(r.a);o.push([e.i,".image-manager {\n  z-index: 800;\n}\n.image-manager .modal-body .col-xs-2 {\n  margin-top: 6px;\n  margin-bottom: 6px;\n}\n.image-manager .modal-footer .pagination {\n  margin: 0;\n}\n.image-manager .modal-header h4 {\n  margin: 0;\n}\n.image-manager .image-thumber {\n  margin: 10px;\n  float: left;\n  position: relative;\n}\n.image-manager .image-upload {\n  margin: 10px;\n  float: left;\n}\n","",{version:3,sources:["webpack://./content/image-manager.less"],names:[],mappings:"AAAA;EACE,YAAY;AACd;AACA;EACE,eAAe;EACf,kBAAkB;AACpB;AACA;EACE,SAAS;AACX;AACA;EACE,SAAS;AACX;AACA;EACE,YAAY;EACZ,WAAW;EACX,kBAAkB;AACpB;AACA;EACE,YAAY;EACZ,WAAW;AACb",sourcesContent:[".image-manager {\n  z-index: 800;\n}\n.image-manager .modal-body .col-xs-2 {\n  margin-top: 6px;\n  margin-bottom: 6px;\n}\n.image-manager .modal-footer .pagination {\n  margin: 0;\n}\n.image-manager .modal-header h4 {\n  margin: 0;\n}\n.image-manager .image-thumber {\n  margin: 10px;\n  float: left;\n  position: relative;\n}\n.image-manager .image-upload {\n  margin: 10px;\n  float: left;\n}\n"],sourceRoot:""}]),t.a=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),r=n(3);n(15);let a=n(4).getStrings();class o extends i.Component{constructor(e){super(e),this.state={selectedText:""}}setDeleteButton(e,t){e&&r.buttonOnClick(e,e=>(e.stopPropagation(),e.cancelBubble=!0,this.props.remove?this.props.remove(t):Promise.resolve()),{confirm:a.deleteImageConfirm})}render(){let{imagePath:e,className:t,onClick:n,selectedText:a,text:o,title:s,disabled:l}=this.props;return t=t||"",o=o||"",i.createElement("div",{className:"image-thumber "+t,title:s,"data-url":e,onClick:e=>{l||this.props.onClick&&this.props.onClick(this,e)}},i.createElement("div",{className:"item text-center  "+(a?"selected":"")},i.createElement("div",{className:"triangle"}),i.createElement("div",{className:"top"},a),this.props.remove?i.createElement("div",{className:"remove"},i.createElement("i",{className:"fa fa-remove",ref:t=>this.setDeleteButton(t,e)})):null,i.createElement("img",{className:"img-responsive",src:e,ref:e=>e?r.renderImage(e,{imageSize:{width:150,height:150}}):null}),o?i.createElement("div",{className:"bottom"},o):null,l?i.createElement("div",{className:"disabled"}):null,this.props.children))}}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),r=n(3);n(16);const a=n(4),o=n(12);let s=a.getStrings();class l extends i.Component{constructor(e){super(e),this.state={imageSource:e.imageSource}}updloadImage(e){let{width:t,height:n}=this.props;r.imageFileToBase64(e).then(e=>{this.props.saveImage(e),this.setState({imageSource:e.base64})})}setFileInput(e){e&&!e.onchange&&(this.file=e,e.onchange=()=>{null!=e.files&&e.files.length>0&&this.updloadImage(e.files[0])})}componentDidMount(){}setSizes(){let e=this.itemElement.offsetWidth;e<10&&setTimeout(()=>{this.setSizes()},100);let t=e,n=0;this.itemElement.style.height=t+"px",t>80&&(n=(t-80)/2,this.itemElement.style.paddingTop=n+"px"),this.file.style.marginTop=`-${t-n}px`,this.file.style.width=e+"px",this.file.style.height=t+"px"}render(){let{title:e,className:t}=this.props,{imageSource:n}=this.state||{};return e=e||s.imageUpload,t=t||"",null==n||null==this.props.displayImage?i.createElement("div",{className:"image-upload "+t,style:this.props.style},i.createElement("div",{className:"item",ref:e=>this.itemElement=e||this.itemElement},i.createElement(i.Fragment,null,i.createElement("i",{className:"fa fa-plus fa-4x"}),i.createElement("div",null,e)),i.createElement("input",{type:"file",style:{},ref:e=>this.setFileInput(e)}))):this.props.displayImage.fixed?i.createElement("div",{className:"image-upload "+t,style:this.props.style},i.createElement("div",{className:"item",ref:e=>this.itemElement=e||this.itemElement},i.createElement("img",{src:n,style:{width:"100%",height:"100%"}}))):i.createElement("div",{ref:e=>{if(!e)return;let t=document.createElement("img");t.src=n,t.onload=t=>{var n;let i=t.target.width,r=t.target.height,a=null===(n=this.props.displayImage)||void 0===n?void 0:n.maxWidth;if(a){r=a*(r/i),i=a}e.style.backgroundImage=`url(${t.target.src})`,e.style.backgroundSize=`${i}px ${r}px`,e.style.backgroundRepeat="no-repeat";let o=e.querySelector('[type="file"]');o.style.width=i+"px",o.style.height=r+"px"},o.render(i.createElement(i.Fragment,null,i.createElement("input",{type:"file",style:{opacity:0},ref:e=>this.setFileInput(e)})),e)}})}}t.default=l},function(e,t){e.exports=i},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageService=t.errors=void 0;const r=n(19),a=n(6),o=n(3);let s=n(4).getStrings();t.errors={serviceUrlCanntNull:e=>new Error(`Service '${e}' base url can not null.`),unexpectedNullResult:()=>new Error("Null result is unexpected."),unexpectedNullValue:e=>new Error(`variable ${e} is unexpected null value.`),argumentNull:e=>new Error(`Arugment ${e} cannt null or empty.`),fieldNull:(e,t)=>new Error(`${t} ${e} cannt be null or empty`),instanceMessangerStart:()=>new Error("Instance messanger is start."),notSupportedInNode:()=>new Error("Not implement in node environment.")};class l extends r.Service{constructor(){super(e=>l.errorHandle(e))}url(e){return a.pathConcat(l.serviceHost,e)}imageSource(e,t,n){if(!e)return t=null==t?200:t,n=null==n?200:n,e=this.generateImageBase64(t,n,s.noImageText);if(e.startsWith("data:image"))return e;if(null!=e&&(e.startsWith("http://")||e.startsWith("https://")))return e;if(null!=e&&e.indexOf("/")>=0){let i=a.pathConcat(l.serviceHost,e),r="";return null!=t&&(r=r+"&width="+t),null!=n&&(r=r+"&height="+n),r.length>0&&(r=r.substr(1),i=i+"?"+r),i}let i=this.url("image");return i=`${i}?id=${e}`,null!=t&&(i=i+"&width="+t),null!=n&&(i=i+"&height="+n),i}generateImageBase64(e,n,i,r){if(null==document)throw t.errors.notSupportedInNode();var a=document.createElement("canvas");a.width=e,a.height=n;var o=a.getContext("2d");if(null==o)throw new Error("ccreate canvas context fail.");return("string"==typeof i?u.text(i,r):i)(o,e,n),a.toDataURL()}getImageSize(e){if(!e)throw t.errors.argumentNull("imageBase64");return new Promise((t,n)=>{var i=new Image;i.onload=function(){t({width:i.width,height:i.height})},i.src=e})}resize(e,n,r){return i(this,void 0,void 0,(function*(){if(!e)throw t.errors.argumentNull("imageBase64");if(!n)throw t.errors.argumentNull("width");if(!r)throw t.errors.argumentNull("height");var i=document.createElement("canvas"),a=i.getContext("2d");return i.width=n,i.height=r,yield new Promise((t,n)=>{var r=new Image;r.src=e,r.onload=function(){if(null==a)throw"get canvas context fail";a.drawImage(r,0,0,i.width,i.height),t(i.toDataURL())}})}))}list(e){return i(this,void 0,void 0,(function*(){let t=this.url("list");return yield this.postByJson(t,e)}))}upload(e){return i(this,void 0,void 0,(function*(){if(!e)throw t.errors.argumentNull("imageBase64");let n=this.url("upload"),i=yield this.getImageSize(e);if(i.width>800){let t=i.height/i.width*800;e=yield this.resize(e,800,t)}else if(i.height>800){let t=i.width/i.height*800;e=yield this.resize(e,t,800)}return this.postByJson(n,{image:e})}))}remove(e){return i(this,void 0,void 0,(function*(){if(!e)throw t.errors.argumentNull("id");let n=this.url("remove");return this.postByJson(n,{id:e})}))}}t.ImageService=l,l.errorHandle=e=>{o.alert({title:"错误",message:e.message})};let u={text:(e,t)=>(n,i,r)=>{let a=Math.floor(i/e.length*.6);t=t||{},n.fillStyle=t.bgColor||"whitesmoke",n.fillRect(0,0,i,r),n.font=`Bold ${t.fontSize}px Arial`,n.textAlign="left",n.fillStyle=t.textColor||"#999";let o=a*e.length,s=Math.floor(.5*(i-o));Math.floor(.3*(r-(t.fontSize||a)));n.fillText(e,s,Math.floor(.6*r))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageService=t.showImageDialog=t.ImageUpload=t.ImageThumber=void 0;var i=n(10);Object.defineProperty(t,"ImageThumber",{enumerable:!0,get:function(){return i.default}});var r=n(11);Object.defineProperty(t,"ImageUpload",{enumerable:!0,get:function(){return r.default}});var a=n(17);Object.defineProperty(t,"showImageDialog",{enumerable:!0,get:function(){return a.showImageDialog}});var o=n(13);Object.defineProperty(t,"ImageService",{enumerable:!0,get:function(){return o.ImageService}})},function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(7),o={insert:"head",singleton:!1};r()(a.a,o);t.default=a.a.locals||{}},function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(8),o={insert:"head",singleton:!1};r()(a.a,o);t.default=a.a.locals||{}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.showImageDialog=void 0;const r=n(11),a=n(10),o=n(5),s=n(12),l=n(18),u=n(3),c=n(13),m=n(4),d=n(6);n(20);const p=n(21);let h=m.getStrings();class g extends o.Component{constructor(e){super(e),this.state={images:[],selectedItems:[]},this.selectArguments={maximumRows:17},this.dataSource=function(){let e=new c.ImageService;return new d.DataSource({primaryKeys:["id"],select(t){return i(this,void 0,void 0,(function*(){return yield e.list(t)}))},delete(t){return i(this,void 0,void 0,(function*(){return yield e.remove(t.id)}))},insert(t){return i(this,void 0,void 0,(function*(){console.assert(null!=t.data);let n=yield e.upload(t.data);return Object.assign(t,n),n}))}})}(),this.dataSource.selected.add(e=>{this.setState({images:e.selectResult.dataItems})}),this.dataSource.inserted.add(e=>{this.state.images.push(e.dataItem),this.setState({images:this.state.images})}),this.imageService=new c.ImageService}componentDidMount(){return i(this,void 0,void 0,(function*(){new p.DataSourcePagingBar({dataSource:this.dataSource,element:this.pagingBarElement,pagerSettings:{activeButtonClassName:"active",buttonWrapper:"li",buttonContainerWraper:"ul",showTotal:!1}});let e=this.pagingBarElement.querySelector("ul");e&&(e.className="pagination")}))}show(e,t){this.showDialogCallback=t,this.selectArguments.startRowIndex=0,this.dataSource.select(this.selectArguments),this.setState({selectedItems:[],selectedMax:e}),u.showDialog(this.props.element)}saveImage(e){return i(this,void 0,void 0,(function*(){this.dataSource.insert({data:e})}))}removeImage(e){this.dataSource.delete(e);let t=this.state.images;t=t.filter(t=>t.id!=e.id),this.setState({images:t})}render(){let{images:e,selectedItems:t,selectedMax:n}=this.state,i=this.props.element;return o.createElement("div",{className:"modal-dialog modal-lg"},o.createElement("div",{className:"modal-content"},o.createElement("div",{className:"modal-header"},o.createElement("button",{type:"button",className:"btn close",onClick:()=>u.hideDialog(i)},o.createElement("span",{"aria-hidden":"true"},"×")),o.createElement("h4",{className:"modal-title"},h.selectImage)),o.createElement("div",{className:"modal-body"},e.map(e=>{let i=t.indexOf(e.id)>=0?""+(t.indexOf(e.id)+1):"",r=t.length==n;return o.createElement(a.default,{key:e.id,imagePath:this.imageService.imageSource(e.id,150,150),remove:()=>this.removeImage(e),selectedText:i,disabled:r&&!i,text:null!=e.width&&null!=e.height?`${e.width} X ${e.height}`:" ",onClick:()=>{let t=this.state.selectedItems;if(t.indexOf(e.id)>=0)t=t.filter(t=>t!=e.id);else{if(t.length==n)return;t.push(e.id)}this.setState({selectedItems:t})}})}),o.createElement(r.default,{saveImage:e=>this.saveImage(e.base64),width:400}),o.createElement("div",{className:"clearfix"})),o.createElement("div",{className:"modal-footer"},o.createElement("div",{className:"pull-left",ref:e=>this.pagingBarElement=e||this.pagingBarElement}),n?o.createElement("div",{className:"pull-left",style:{paddingTop:8,paddingLeft:10}},h.selectMax,o.createElement("b",{style:{padding:"0 2px 0 2px"}},n),"张"):null,o.createElement("button",{name:"cancel",type:"button",className:"btn btn-default",onClick:()=>u.hideDialog(i)},h.cancel),o.createElement("button",{name:"ok",type:"button",className:"btn btn-primary",disabled:0==t.length,onClick:()=>{if(this.showDialogCallback){let e=this.state.selectedItems.map(e=>e);this.showDialogCallback(e)}u.hideDialog(i)}},h.confirm))))}}let A=l.createDialogElement("image-manager"),f=s.render(o.createElement(g,{element:A}),A);t.default={show(e){f.show(void 0,e)}},t.showImageDialog=function(e,t){"function"==typeof e&&(t=e=null),f.show(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDialogElement=t.imageUrl=void 0,t.imageUrl=function(e,t,n){if(!e)return e;if(e.startsWith("data:image"))return e;if(e.indexOf(",")>0&&(e=e.split(",")[0]),e.startsWith("http://")){let t=(e=e.substr("http://".length)).indexOf("/");console.assert(t>0),e=e.substr(t)}else"/"==e[0]&&(e=e.substr(1));let i=new Array,r=(location.protocol,""+e);return t&&(i.push({name:"width",value:t.toString()}),n&&i.push({name:"height",value:n.toString()})),navigator.userAgent.indexOf("chrome")<0&&i.push({name:"type",value:"jpeg"}),i.length>0&&(r=r+"?"+i.map(e=>`${e.name}=${e.value}`).join("&")),r},t.createDialogElement=function(e){let t=document.createElement("div");return t.className="modal fade "+e,t.style.zIndex="1000",document.body.appendChild(t),t}},function(e,t){e.exports=r},function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(9),o={insert:"head",singleton:!1};r()(a.a,o);t.default=a.a.locals||{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataSourcePagingBar=t.PagingBar=t.PagerPosition=void 0;const i=n(22);!function(e){e[e.Bottom=0]="Bottom",e[e.Top=1]="Top",e[e.TopAndBottom=2]="TopAndBottom"}(t.PagerPosition||(t.PagerPosition={}));class r{init(e){this._pageIndex=0;var t=this;t.totalRowCount=1e6,e&&(e.selected.add(e=>{this._selectArguments=e.selectArguments,t.pageSize=e.selectArguments.maximumRows||0;var n=e.selectResult.totalRowCount;null!=n&&n>=0&&(t.totalRowCount=n);var i=this._selectArguments.startRowIndex;(null==i||i<=0)&&(i=0),t.pageIndex=Math.floor(i/t.pageSize),t.render()}),e.deleted.add((function(){t.totalRowCount=t.totalRowCount-1,t.render()})),e.inserted.add((function(){t.totalRowCount=t.totalRowCount+1,t.render()})))}get selectArguments(){return console.assert(null!=this._selectArguments),this._selectArguments}get pageCount(){return Math.ceil(this.totalRowCount/this.pageSize)}get pageSize(){return this._pageSize}set pageSize(e){this._pageSize=e}get pageIndex(){return this._pageIndex}set pageIndex(e){this._pageIndex=e}get totalRowCount(){return this._totalRowCount}set totalRowCount(e){this._totalRowCount=e}render(){throw i.errors.notImplemented("The table-row render method is not implemented.")}}t.PagingBar=r;class a extends r{constructor(e){if(!e.dataSource)throw i.errors.argumentNull("dataSource");if(!e.element)throw i.errors.argumentNull("element");let t=Object.assign(a.defaultPagerSettings,e.pagerSettings||{});super(),this.dataSource=e.dataSource,this.pagerSettings=t,this.element=e.element,this.numberButtons=new Array,this.createButton=this.createPagingButton,this.createLabel=this.createTotalLabel;let n=t.buttonContainerWraper?document.createElement(t.buttonContainerWraper):document.createElement("div");n.className=t.buttonContainerClassName||"buttons",this.element.appendChild(n),this.createPreviousButtons(n),this.createNumberButtons(n),this.createNextButtons(n),this.pagerSettings.showTotal&&(this.totalElement=this.createLabel(),this.totalElement.visible=!1),this.init(e.dataSource)}createPagingButton(e){var t=this.pagerSettings;let n=document.createElement("a");if(n.href="javascript:",this.pagerSettings.buttonWrapper){let t=document.createElement(this.pagerSettings.buttonWrapper);t.appendChild(n),e.appendChild(t)}else e.appendChild(n);let i={_button:n,get visible(){return"none"!=this._button.style.display},set visible(e){let n=this._button,i=t.buttonWrapper?n.parentElement:n;null!=i&&(e?i.style.removeProperty("display"):i.style.display="none")},get pageIndex(){let e=this._button;return new Number(e.getAttribute("pageIndex")).valueOf()},set pageIndex(e){this._button.setAttribute("pageIndex",e)},get text(){return this._button.innerHTML},set text(e){this._button.innerHTML=e},get active(){return null!=this._button.href},set active(e){let n=this._button;if(1==e)return n.removeAttribute("href"),void(t.activeButtonClassName&&this.setClassName(t.activeButtonClassName));n.href="javascript:",t.buttonClassName?this.setClassName(t.buttonClassName):this.setClassName(null)},setClassName(e){let n=this._button,i=t.buttonWrapper?n.parentElement:n;null!=i&&(e?i.className=e:i.removeAttribute("class"))},onclick:null};return n.onclick=()=>{i.onclick&&i.onclick(i,this)},i}createTotalLabel(){let e=document.createElement("div");e.className="total";let t=document.createElement("span");t.className="text",t.innerHTML="总记录：",e.appendChild(t);let n=document.createElement("span");return n.className="number",e.appendChild(n),this.element.appendChild(e),{get text(){return n.innerHTML},set text(e){n.innerHTML=e},get visible(){return"none"!=e.style.display},set visible(t){e.style.display=1==t?"block":"node"}}}createPreviousButtons(e){this.firstPageButton=this.createButton(e),this.firstPageButton.onclick=a.on_buttonClick,this.firstPageButton.text=this.pagerSettings.firstPageText,this.firstPageButton.visible=!1,this.previousPageButton=this.createButton(e),this.previousPageButton.onclick=a.on_buttonClick,this.previousPageButton.text=this.pagerSettings.previousPageText,this.previousPageButton.visible=!1}createNextButtons(e){this.nextPageButton=this.createButton(e),this.nextPageButton.onclick=a.on_buttonClick,this.nextPageButton.text=this.pagerSettings.nextPageText,this.nextPageButton.visible=!1,this.lastPageButton=this.createButton(e),this.lastPageButton.onclick=a.on_buttonClick,this.lastPageButton.text=this.pagerSettings.lastPageText,this.lastPageButton.visible=!1}createNumberButtons(e){let t=this,n=this.pagerSettings.pageButtonCount;for(let t=0;t<n;t++){let n=this.createButton(e);n.onclick=a.on_buttonClick,this.numberButtons[t]=n}this.numberButtons.forEach(e=>{e.onclick=()=>a.on_buttonClick(e,t)})}static on_buttonClick(e,t){let n=e.pageIndex;if(null==!n)return;let i=t.selectArguments;i.maximumRows=t.pageSize,i.startRowIndex=n*t.pageSize,t.pageIndex=n,t.dataSource.select(t.selectArguments)}render(){var e=this.pagerSettings.pageButtonCount;let t=Math.floor(this.pageIndex/e),n=Math.ceil(this.pageCount/e);this.previousPageButton.pageIndex=(t-1)*e,this.nextPageButton.pageIndex=(t+1)*e,this.firstPageButton.pageIndex=0,this.lastPageButton.pageIndex=this.pageCount-1;for(let n=0;n<this.numberButtons.length;n++){let i=t*e+n;i<this.pageCount?(this.numberButtons[n].pageIndex=i,this.numberButtons[n].text=(t*e+n+1).toString(),this.numberButtons[n].visible=!0,this.numberButtons[n].active=i==this.pageIndex):this.numberButtons[n].visible=!1}this.totalElement&&(this.totalElement.text=this.totalRowCount,this.totalElement.visible=!0),this.firstPageButton.visible=!1,this.previousPageButton.visible=!1,this.lastPageButton.visible=!1,this.nextPageButton.visible=!1,t>0&&(this.firstPageButton.visible=!0,this.previousPageButton.visible=!0),t<n-1&&(this.lastPageButton.visible=!0,this.nextPageButton.visible=!0)}}t.DataSourcePagingBar=a,a.defaultPagerSettings={pageButtonCount:10,firstPageText:"<<",lastPageText:">>",nextPageText:"...",previousPageText:"...",showTotal:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errors=void 0;const i=n(6);class r extends i.Errors{serviceHostNotConfig(){return new Error("Service host is not config.")}notImplemented(e){return e=e||"Not implemented",new Error(e)}}t.errors=new r}])}));
//# sourceMappingURL=index.min.js.map